<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <script src="https://static.line-scdn.net/liff/edge/versions/2.13.0/sdk.js"></script>
  <link rel="stylesheet" href="styles.css">
  <script>
    google.script.run
    .withSuccessHandler(updateSelectOptions)
    .getIdsforTechnician(<?=  userid ?>);

    function updateSelectOptions(ids) {

      var select = document.getElementById('selectId');
      ids.forEach(function(id) {
        var option = document.createElement('option');
        option.value = id;
        option.text = id;
        select.appendChild(option);
      });
    }

    document.getElementById("submitButton").addEventListener("click", function() {
      var description = document.getElementById("description").value;
      var image = document.getElementById("image").files[0];

      var id = document.getElementById('selectId').value;

      var userId = <?=  userid ?> ;
      var displayName = <?=  displayname ?> ;

      if (description && image) {

       alert("ระบบใช้เวลาบันทึกสักครู่ โปรดอย่าปิดหน้าต่าง");
        const fr = new FileReader();
        fr.onload = function(e) {
      const obj = {
        filename: image.name,
        mimeType: image.type,
        bytes: [...new Int8Array(e.target.result)]
      };
      google.script.run.withSuccessHandler(onSuccess).uploadFileToDrivefortechnician(obj, "TechnicialImages", image.name);
    

    };
    fr.readAsArrayBuffer(image);

        
        function onSuccess(url) {

            google.script.run.updateSheetfortechnician(id, description, url);
            alert("Form submitted successfully!");
          
        }
      } else {
        alert("Please provide both description and image.");
      }
    });
  </script>
</head>

<body>
  <label for="selectId">Select Job ID:</label>
  <select id="selectId"></select><br>
  <label for="description">รายงานการซ่อม</label><br>
  <textarea id="description" name="description" rows="4" cols="50"></textarea><br>
  <label for="image">รูปภาพประกอบการซ่อม:</label><br>
  <input type="file" id="image" name="image"><br><br>
  <button id="submitButton">Submit</button>
</body>

</html>