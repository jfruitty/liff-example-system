<!DOCTYPE html>
<html>

<head>
  <script src="https://static.line-scdn.net/liff/edge/versions/2.13.0/sdk.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <label for="description">คำอธิบายอาการ</label><br>
  <textarea id="description" name="description" rows="4" cols="50"></textarea><br><br>
  <label for="image">รูปภาพประกอบ:</label><br>
  <input type="file" id="image" name="image"><br><br>
  <button id="submitButton">Submit</button>

  <script>

    liff.init({ liffId: "2000454945-mEl8eZP8" }, () => {
      if (liff.isLoggedIn()) {
        const idToken = liff.getDecodedIDToken();
        console.log(idToken);
        const profile = liff.getProfile();
        console.log(profile);

        runApp();


      } else {
        liff.login();

      }
    }).catch((err) => {
      // Error happens during initialization
      console.log(err.code, err.message);
    });




    function runApp() {
      
    document.getElementById("submitButton").addEventListener("click", function() {
      var description = document.getElementById("description").value;
      var imageInput = document.getElementById("image");
      var imageFile = imageInput.files[0];
      
      if (!description || !imageFile) {
        alert("Please fill in all fields.");
        return;
      }

      var formData = new FormData();
      formData.append("fileBlob", imageFile);
      formData.append("folderName", "your-folder-name");
      formData.append("fileName", imageFile.name);

      var xhr = new XMLHttpRequest();
      xhr.open("POST", "https://script.google.com/macros/s/AKfycbysUOlE5LYTnffqlGCLOW-7L3ArcSEL8WWhO8Sf8OszxY-4eNroEX61TdQ9ghpxXU6W/exec", true);
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            if (response.success) {
              alert("File uploaded successfully.");
            } else {
              alert("An error occurred: " + response.message);
            }
          } else {
            alert("An error occurred while uploading the file.");
          }
        }
      };
      
      var apiData = {
        api: "uploadFileToDrive"
      };
      xhr.send(JSON.stringify({ postData: { contents: JSON.stringify(apiData) }, fileBlob: imageFile }));
    });
 

    }




  </script>
</body>

</html>