<!DOCTYPE html>
<html>

<head>
  <script src="https://static.line-scdn.net/liff/edge/versions/2.13.0/sdk.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>

<script>
  google.script.run
    .withSuccessHandler(updateSelectOptions)
    .getJobCustomerIds(<?=  userid ?>);


    function updateSelectOptions(ids) {

      var select = document.getElementById('selectId');
      ids.forEach(function(id) {
        var option = document.createElement('option');
        option.value = id;
        option.text = id;
        select.appendChild(option);
      });
    }

    document.getElementById("submitButton").addEventListener("click", function() {
      
      var image = document.getElementById("image").files[0];

      var userId = <?=  userid ?> ;

      var jobid = document.getElementById('selectId').value;

      if (image) {

       alert("ระบบใช้เวลาบันทึกสักครู่ โปรดอย่าปิดหน้าต่าง");
        const fr = new FileReader();
        fr.onload = function(e) {
      const obj = {
        filename: image.name,
        mimeType: image.type,
        bytes: [...new Int8Array(e.target.result)]
      };
      google.script.run.withSuccessHandler(onSuccess).uploadSlipToDrive(obj, "SlipImages", image.name);

      

    };
    fr.readAsArrayBuffer(image);

        function onSuccess(url) {
          google.script.run.updateSheetforSlip(jobid, url); 
          
          alert("Form submitted successfully!");
        }
      } else {
        alert("Please provide image.");
      }
    });
</script>

<body>

  <label for="selectId">Job ID:</label>
  <select id="selectId"></select><br>
  <label for="image">แนบรูปสลิปโอนเงิน:</label><br>
  <input type="file" id="image" name="image"><br><br>
  <button id="submitButton">Submit</button>

</body>

</html>